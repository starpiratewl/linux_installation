##1, download mysql community server from http://dev.mysql.com/downloads/mysql/.  select the Linux - Generic (glibc 2.5) (x86, 64-bit), Compressed TAR version. 5.7.14

##2,  yum install gcc
##    yum install gcc-c++
##    yum install libaio
##    yum -y install ncurses-devel
##    yum install libxml2-devel
##    yum install libxml2


##3,  cd /usr/local/src
##    tar -zvxf /home/star/Downloads/mysql-5.7.14-linux-glibc2.5-x86_64.tar.gz 
##    mv mysql-5.7.14-linux-glibc2.5-x86_64/ mysql
##    mkdir mysql/data
##    groupadd mysql
##    useradd mysql -g mysql
##    cd mysql
##    pwd
##    /usr/local/src/mysql
##    chown -R mysql .
##    chgrp -R mysql .


##    cd /usr/local/src/mysql/bin
##    [root@localhost bin]# ./mysql_install_db --user=mysql --basedir=/usr/local/mysql/ --datadir=/usr/local/mysql/data

2016-08-24 12:12:45 [WARNING] mysql_install_db is deprecated. Please consider switching to mysqld --initialize
2016-08-24 12:13:09 [WARNING] The bootstrap log isn't empty:
2016-08-24 12:13:09 [WARNING] 2016-08-24T16:12:45.432997Z 0 [Warning] --bootstrap is deprecated. Please consider using --initialize instead
2016-08-24T16:12:45.433691Z 0 [Warning] Changed limits: max_open_files: 1024 (requested 5000)
2016-08-24T16:12:45.433700Z 0 [Warning] Changed limits: table_open_cache: 431 (requested 2000)


##    [root@localhost mysql]# bin/mysqld_safe --user=mysql &


##    cd /usr/local/src/mysql/support-files
##    ./mysql.server start
##    Starting MySQL...The server quit without updating PID file [FAILED]b/mysql/localhost.localdomain.pid).

##    This error can be fixed by following steps
##    vi /etc/my.cnf
##    add "datadir = /usr/local/mysql/data"  below the [mysqld]
##    The final version my.cnf should like this:
##[mysqld]
##datadir=/usr/local/mysql/data
##socket=/var/lib/mysql/mysql.sock
##user=mysql
### Disabling symbolic-links is recommended to prevent assorted security risks
##symbolic-links=0

##[mysqld_safe]
##log-error=/var/log/mysqld.log
##pid-file=/var/run/mysqld/mysqld.pid

##    cd /usr/local/mysql/support-files
##    ./mysql.server start
##    Starting MySQL.                                            [  OK  ]

##    Actually this error is common when install mysql, there are severl method to fix this problem, and these methods are summarized as follows:

1.可能是/usr/local/mysql/data/rekfan.pid文件没有写的权限
解决方法 ：给予权限，执行 “chown -R mysql:mysql /var/data” “chmod -R 755 /usr/local/mysql/data”  然后重新启动mysqld！

2.可能进程里已经存在mysql进程
解决方法：用命令“ps -ef|grep mysqld”查看是否有mysqld进程，如果有使用“kill -9  进程号”杀死，然后重新启动mysqld！

3.可能是第二次在机器上安装mysql，有残余数据影响了服务的启动。
解决方法：去mysql的数据目录/data看看，如果存在mysql-bin.index，就赶快把它删除掉吧，它就是罪魁祸首了。本人就是使用第三条方法解决的 ！

4.mysql在启动时没有指定配置文件时会使用/etc/my.cnf配置文件，请打开这个文件查看在[mysqld]节下有没有指定数据目录(datadir)。
解决方法：请在[mysqld]下设置这一行：datadir = /usr/local/mysql/data

5.skip-federated字段问题
解决方法：检查一下/etc/my.cnf文件中有没有没被注释掉的skip-federated字段，如果有就立即注释掉吧。

6.错误日志目录不存在
解决方法：使用“chown” “chmod”命令赋予mysql所有者及权限

7.selinux惹的祸，如果是centos系统，默认会开启selinux
解决方法：关闭它，打开/etc/selinux/config，把SELINUX=enforcing改为SELINUX=disabled后存盘退出重启机器试试。

但是没有解决，最后直接给/usr/local/mysql/data 目录 chmod 777 -R  /usr/local/myql/data 问题解决 应该是 权限问题，不能生成localhost.localdomain.pid 文件

## reference link: http://www.111cn.net/database/mysql/47258.htm


##4, [root@localhost support-files]# cat /root/.mysql_secret
# Password set for user 'root@localhost' at 2016-08-22 18:15:53 
haohSUes+_)<

##This is the random password to land on the mysql server, we can use this password to land on mysql

cd /usr/local/mysql/bin

./mysql -u root -p
Enter password: 
ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)
 
## This error can be fixed by create a soft link. Remember the /etc/my.cnf file , we have specified the position of mysql.sock.But this error present that '/tmp/mysql.sock', we found that there isn't any mysql.sock file under the /tmp directery. So what we need to do is to create a soft link, link betweem the two files.
ln -s /var/lib/mysql/mysql.sock /tmp/mysql.sock

[root@localhost bin]# ./mysql -u root -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.7.14

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 



##5, shoot the mysql start problem

under the current circumstances, we have to :
cd /usr/local/mysql/bin
./mysql -uroot -p

to land on the mysql server. It is very boring. Do as following:
*首先需要将scripts/mysql.server服务脚本复制到/etc/init.d/，并重命名为mysqld。
cp support-files/mysql.server /etc/init.d/mysqld
*通过chkconfig命令将mysqld服务加入到自启动服务项中。
chkconfig --add mysqld
*注意服务名称mysqld就是我们将mysql.server复制到/etc/init.d/时重命名的名称。

## To verify the configuration.
[root@localhost mysql]# chkconfig --list mysqld
mysqld         	0:off	1:off	2:on	3:on	4:on	5:on	6:off

## now restart the system, and the mysql server will be initiated.
[root@localhost support-files]# netstat -anp|grep mysqld
tcp        0      0 :::3306                     :::*                        LISTEN      2968/mysqld         
unix  2      [ ACC ]     STREAM     LISTENING     17623  2968/mysqld         /var/lib/mysql/mysql.sock
## successfully initiated.

## if don't want to initiate the mysql server, we can also initiate the msyql server manually.
[root@localhost support-files]# service mysqld start
Starting MySQL                                             [  OK  ]

## to verify if we can land on the msyql server:
[root@localhost support-files]# /usr/local/mysql/bin/mysql -uroot -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.7.14

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 


## 6, it is boring to land on mysql server through /usr/local/mysql/bin/mysql -u root -p, we can set the environmental variable to fix this.
方法一： 
在/etc/profile文件中最后一行添加变量export PATH=$PATH:/usr/local/mysql/bin
【对所有用户生效（永久的）】  
用VI在文件/etc/profile文件中增加变量，该变量将会对Linux下所有用户有效，并且是“永久的”。  
要让刚才的修改马上生效，需要执行以下代码  
# source /etc/profile  

方法二：  
在用户目录下的.bash_profile文件中增加变量【对单一用户生效（永久的）】  
用VI在用户目录下的.bash_profile文件中增加变量，改变量仅会对当前用户有效，并且是“永久的”。  
要让刚才的修改马上生效，需要在用户目录下执行以下代码  
# source .bash_profile

方法三：
直接运行export命令定义变量【只对当前shell（BASH）有效（临时的）】 
在shell的命令行下直接使用[export变量名=变量值]定义变量，该变量只在当前的shell（BASH）或其子shell（BASH）下是有效的，shell关闭了，变量也就失效了，再打开新shell时就没有这个变量，需要使用的话还需要重新定义。
例如：export PATH=$PATH:/usr/local/mysql/bin

## then we can directly start mysql in terminal window without specify the path
[root@localhost support-files]# mysql -r root -p
Enter password: 
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)




## 7,fix the password problem

when we perform SQL query in the mysql, it prompt:
mysql> show databases;
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.

##land on mysql server
mysql> set password=password('123456');
Query OK, 0 rows affected, 1 warning (0.19 sec)

## then we can reland on the mysql server with new password

## 8,设定远程登录mysql。在Linux下为了安全，默认是不允许mysql本机以外的机器访问mysql数据库服务，因此需要重新授权root。方便远程访问。

mysql> use mysql;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

mysql> select Host,User from user;
+-----------+-----------+
| Host      | User      |
+-----------+-----------+
| localhost | mysql.sys |
| localhost | root      |
+-----------+-----------+
2 rows in set (0.00 sec)


mysql> GRANT ALL PRIVILEGES ON *.* TO root@'%' identified by 'leizm';
Query OK, 0 rows affected, 1 warning (0.00 sec)


mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

##授权语句最后的‘leizm’是mysql数据库root用户的新密码。


##9，非必要的步骤，如果远程连不上，估计是防火墙的问题，关闭试试：


[root@localhost mysql]# service iptables stop

setenforce 0iptables：将链设置为政策 ACCEPT：filter [确定]

iptables：清除防火墙规则： [确定]

iptables：正在卸载模块： [确定]

[root@localhost mysql]# setenforce 0

setenforce: SELinux is disable 








###########################################################################################################################
## follow the installation instructions from http://dev.mysql.com/doc/refman/5.7/en/binary-installation.html
###########################################################################################################################


shell> groupadd mysql
shell> useradd -r -g mysql -s /bin/false mysql
shell> cd /usr/local
shell> tar zxvf /path/to/mysql-VERSION-OS.tar.gz
shell> ln -s full-path-to-mysql-VERSION-OS mysql
shell> cd mysql
shell> mkdir mysql-files
shell> chmod 750 mysql-files
shell> chown -R mysql .
shell> chgrp -R mysql .
shell> bin/mysql_install_db --user=mysql    # Before MySQL 5.7.6
shell> bin/mysqld --initialize --user=mysql # MySQL 5.7.6 and up

## prompt error here, it seem that some files have been written, I remember the centos has a default mysql installed, that maybe the problem, so I have to remove the default installed mysql here.

##[root@localhost mysql]# rpm -qa | grep mysql
##mysql-libs-5.1.73-7.el6.x86_64
##[root@localhost mysql]# yum remove mysql-libs-5.1.73-7.el6.x86_64

## after remove this , the installation seems to continue.

[root@localhost mysql]# bin/mysqld --initialize --user=mysql
2016-08-24T17:23:51.994596Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).
2016-08-24T17:23:55.124848Z 0 [Warning] InnoDB: New log files created, LSN=45790
2016-08-24T17:23:55.663441Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.
2016-08-24T17:23:55.869064Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: 8923226f-6a1f-11e6-8d71-74f06d78cd91.
2016-08-24T17:23:55.908715Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.
2016-08-24T17:23:55.910466Z 1 [Note] A temporary password is generated for root@localhost: -?PY(ALaC4_v

[root@localhost mysql]# bin/mysql_ssl_rsa_setup
Generating a 2048 bit RSA private key
.......+++
...+++
writing new private key to 'ca-key.pem'
-----
Generating a 2048 bit RSA private key
..................+++
............................................................................+++
writing new private key to 'server-key.pem'
-----
Generating a 2048 bit RSA private key
.....................+++
...+++
writing new private key to 'client-key.pem'
-----

shell> chown -R root .
shell> chown -R mysql data mysql-files
shell> bin/mysqld_safe --user=mysql &
# Next command is optional
shell> cp support-files/mysql.server /etc/init.d/mysql.server


[root@localhost mysql]# bin/mysql -u root -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.7.14

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 


## now we have successfully installed the mysql
